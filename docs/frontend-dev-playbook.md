# FireAlert Frontend Dev Playbook (Senkronizasyon, Rehber ve Changelog)

Bu dok√ºman, frontend geli≈ütiricilerin proje baƒülamƒ±ndan kopmadan API'leri, route'larƒ±, navigasyonu ve state y√∂netimini doƒüru ≈üekilde uygulayabilmeleri i√ßin s√ºrekli g√ºncellenen bir rehberdir. Backend PRD & Progress Tracker ile e≈üzamanlƒ± tutulur.

## üìã **Kaynaklar**
- **Frontend PRD & Tracker:** `docs/frontend-prd-and-progress.md`
- **Mevcut Implementasyon:** Phase 1 Foundation (Redux Toolkit + React Native Paper)
- **Backend API:** `https://api.wildfireews.com/v1` (geli≈ütirilme a≈üamasƒ±nda)
- **OpenAPI S√∂zle≈ümesi:** `docs/openapi.yaml` (contract-first - planlanƒ±yor)

---

## 1Ô∏è‚É£ **Mimari Prensipler**

### **Mevcut Durum (Phase 1)**
```typescript
// Teknoloji Stack
- React Native + Expo SDK 53
- Redux Toolkit + RTK Query (hazƒ±r)
- React Native Paper (Material Design 3)
- React Navigation 7.x
- Mock data ile development
```

### **Hedef Mimari (Phase 2+)**
```typescript
// Contract-First Yakla≈üƒ±m
- OpenAPI ‚Üí TypeScript tip √ºretimi
- RTK Query ile cache & invalidation
- Environment-based configuration
```

**Neden contract-first?**
- Tek doƒüruluk kaynaƒüƒ±: `docs/openapi.yaml`
- Tip g√ºvenliƒüi: `openapi-typescript` ile otomatik tip √ºretimi
- Backend-Frontend senkronizasyonu

---

## 2Ô∏è‚É£ **√áevresel Deƒüi≈ükenler**

### **Mevcut Konfig√ºrasyon**
```typescript
// src/constants/index.ts
export const API_ENDPOINTS = {
  BASE_URL: 'https://api.wildfireews.com/v1',
  WEBSOCKET: 'wss://api.wildfireews.com/ws',
  // ... diƒüer endpoint'ler
};
```

### **Hedef .env Yapƒ±sƒ±**
```bash
# Development
API_BASE_URL=http://localhost:3000/v1
WS_URL=ws://localhost:3000/ws
ENVIRONMENT=development

# Staging
API_BASE_URL=https://staging-api.firealert.com/v1
WS_URL=wss://staging-api.firealert.com/ws
ENVIRONMENT=staging

# Production  
API_BASE_URL=https://api.firealert.com/v1
WS_URL=wss://api.firealert.com/ws
ENVIRONMENT=production

# Optional
SENTRY_DSN=your_sentry_dsn
MAPS_API_KEY=your_maps_key
```

---

## 3Ô∏è‚É£ **Navigasyon Yapƒ±sƒ±**

### **Mevcut Implementasyon**
```typescript
// src/navigation/
RootNavigator
‚îú‚îÄ‚îÄ AuthStack (Login, Register)
‚îî‚îÄ‚îÄ MainTabs
    ‚îú‚îÄ‚îÄ Map (Harita + Yangƒ±n Raporlarƒ±)
    ‚îú‚îÄ‚îÄ Reports (Rapor Listesi)
    ‚îú‚îÄ‚îÄ Alerts (Bildirimler)
    ‚îî‚îÄ‚îÄ Settings (Ayarlar)
```

### **Geni≈ületilmi≈ü Yapƒ± (Phase 2+)**
```typescript
MainTabs
‚îú‚îÄ‚îÄ MapStack
‚îÇ   ‚îú‚îÄ‚îÄ Map (ana harita)
‚îÇ   ‚îú‚îÄ‚îÄ ReportDetail
‚îÇ   ‚îî‚îÄ‚îÄ CreateReport (modal)
‚îú‚îÄ‚îÄ ReportsStack  
‚îÇ   ‚îú‚îÄ‚îÄ ReportsList
‚îÇ   ‚îú‚îÄ‚îÄ MyReports
‚îÇ   ‚îî‚îÄ‚îÄ ReportDetail
‚îú‚îÄ‚îÄ AlertsStack
‚îÇ   ‚îú‚îÄ‚îÄ AlertsList
‚îÇ   ‚îî‚îÄ‚îÄ AlertDetail
‚îî‚îÄ‚îÄ SettingsStack
    ‚îú‚îÄ‚îÄ Settings
    ‚îú‚îÄ‚îÄ Profile
    ‚îî‚îÄ‚îÄ Permissions
```

**Deep Link Desteƒüi:**
```typescript
// Bildirimlerden direkt navigasyon
firealert://report/123
firealert://alert/456
```

---

## 4Ô∏è‚É£ **State Y√∂netimi**

### **Mevcut Redux Store**
```typescript
// src/store/index.ts
export const store = configureStore({
  reducer: {
    auth: authSlice,           // ‚úÖ Hazƒ±r
    reports: reportsSlice,     // ‚úÖ Hazƒ±r  
    notifications: notificationsSlice, // ‚úÖ Hazƒ±r
    settings: settingsSlice,   // ‚úÖ Hazƒ±r
  }
});
```

### **RTK Query Servisleri (Phase 2)**
```typescript
// src/store/services/api.ts
export const apiSlice = createApi({
  reducerPath: 'api',
  baseQuery: fetchBaseQuery({
    baseUrl: process.env.API_BASE_URL,
    prepareHeaders: (headers, { getState }) => {
      const token = (getState() as RootState).auth.token;
      if (token) headers.set('authorization', `Bearer ${token}`);
      return headers;
    },
  }),
  tagTypes: ['Report', 'Alert', 'Satellite', 'User'],
  endpoints: (builder) => ({
    // Reports
    getReports: builder.query<Report[], ReportsQuery>({
      query: ({ bbox, hours }) => 
        `reports?bbox=${bbox}&hours=${hours}`,
      providesTags: ['Report'],
    }),
    createReport: builder.mutation<Report, CreateReportData>({
      query: (data) => ({
        url: 'reports',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: ['Report'],
    }),
    // Satellite
    getSatelliteData: builder.query<SatelliteData[], SatelliteQuery>({
      query: ({ bbox, hours }) => 
        `satellite/nearby?bbox=${bbox}&hours=${hours}`,
      providesTags: ['Satellite'],
    }),
    // Alerts
    getAlerts: builder.query<Alert[], void>({
      query: () => 'alerts',
      providesTags: ['Alert'],
    }),
  }),
});
```

---

## 5Ô∏è‚É£ **API Entegrasyonu Stratejisi**

### **Phase 1: Mock Data (Mevcut)**
```typescript
// src/data/fireAlertMockData.ts
export const mockReports = [/* ... */];
export const mockUser = {/* ... */};
```

### **Phase 2: OpenAPI Integration**
```bash
# Tip √ºretimi
npx openapi-typescript ./docs/openapi.yaml -o ./src/types/api-types.ts

# Kullanƒ±m
import type { paths } from './types/api-types';
type ReportsResponse = paths['/reports']['get']['responses']['200']['content']['application/json'];
```

### **Phase 3: Real API Integration**
```typescript
// Environment-based switching
const useRealAPI = process.env.ENVIRONMENT !== 'development';

export const reportsApi = useRealAPI 
  ? apiSlice.endpoints.getReports
  : mockReportsQuery;
```

---

## 6Ô∏è‚É£ **Harita ve Geo Sorgular**

### **Viewport-Based Queries**
```typescript
// Map ekranƒ±nda bbox hesaplama
const handleRegionChange = useMemo(
  () => debounce((region: Region) => {
    const bbox = [
      region.longitude - region.longitudeDelta / 2, // west
      region.latitude - region.latitudeDelta / 2,   // south  
      region.longitude + region.longitudeDelta / 2, // east
      region.latitude + region.latitudeDelta / 2,   // north
    ];
    
    refetch({ bbox: bbox.join(','), hours: timeRange });
  }, 500),
  [timeRange]
);
```

### **Performance Optimizations**
- **Debounce:** 500ms gecikme ile istek atma
- **Min Change Threshold:** K√º√ß√ºk pan/zoom'larda istek atmama  
- **Cache Strategy:** 5 dakika cache, background refetch

---

## 7Ô∏è‚É£ **Hata Y√∂netimi**

### **Global Error Handling**
```typescript
// src/components/common/ErrorBoundary.tsx ‚úÖ Hazƒ±r
// src/utils/errorMapper.ts
export const mapApiError = (error: any): string => {
  if (error.status === 401) return 'Oturum s√ºreniz doldu';
  if (error.status === 403) return 'Bu i≈ülem i√ßin yetkiniz yok';
  if (error.status === 429) return '√áok fazla istek. Bekleyin';
  if (error.status >= 500) return 'Sunucu hatasƒ±. Tekrar deneyin';
  return 'Beklenmeyen hata olu≈ütu';
};
```

### **User Feedback Strategy**
```typescript
// Toast/Snackbar i√ßin
import { Snackbar } from 'react-native-paper';

// Error states
- Network errors: "Baƒülantƒ± hatasƒ±. Tekrar dene"
- Validation errors: Field-specific messages  
- Critical alerts: Red banner with action button
```

---

## 8Ô∏è‚É£ **Bildirimler ve Realtime**

### **Push Notifications (Phase 5)**
```typescript
// Expo Push Token Registration
const registerPushToken = async () => {
  const token = await Notifications.getExpoPushTokenAsync();
  await dispatch(apiSlice.endpoints.registerPushToken.initiate({
    token: token.data,
    platform: Platform.OS,
  }));
};
```

### **WebSocket Integration (Phase 5)**
```typescript
// Real-time updates
const wsClient = new WebSocket(process.env.WS_URL);
wsClient.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  switch (data.type) {
    case 'NEW_REPORT':
      dispatch(apiSlice.util.updateQueryData('getReports', query, (draft) => {
        draft.push(data.report);
      }));
      break;
    case 'CRITICAL_ALERT':
      showCriticalAlert(data);
      break;
  }
};
```

---

## 9Ô∏è‚É£ **Dosya Y√ºkleme Stratejisi**

### **Presigned URL Flow (Phase 4)**
```typescript
// 1. Presigned URL al
const { data: presignedUrl } = await getPresignedUrl.initiate({
  fileName: 'fire-report.jpg',
  contentType: 'image/jpeg',
});

// 2. Dosyayƒ± direkt storage'a y√ºkle
const uploadResponse = await fetch(presignedUrl.url, {
  method: 'PUT',
  body: imageBlob,
  headers: { 'Content-Type': 'image/jpeg' },
});

// 3. Raporu tamamla
await createReport.initiate({
  ...reportData,
  imageUrl: presignedUrl.finalUrl,
});
```

---

## üîü **Development Workflow**

### **Mock Service Worker Setup**
```typescript
// src/mocks/handlers.ts
import { rest } from 'msw';

export const handlers = [
  rest.get('/api/v1/reports', (req, res, ctx) => {
    return res(ctx.json(mockReports));
  }),
  rest.post('/api/v1/reports', (req, res, ctx) => {
    return res(ctx.json({ success: true }));
  }),
];

// src/mocks/browser.ts
import { setupWorker } from 'msw';
import { handlers } from './handlers';

export const worker = setupWorker(...handlers);
```

### **Environment Toggle**
```typescript
// App.tsx
if (__DEV__ && process.env.USE_MOCKS === 'true') {
  import('./src/mocks/browser').then(({ worker }) => {
    worker.start();
  });
}
```

---

## 1Ô∏è‚É£1Ô∏è‚É£ **Testing Strategy**

### **Test Pyramid**
```typescript
// Unit Tests (70%)
- Utils: stringFormatters, validation functions
- Hooks: usePermissions, custom hooks
- Reducers: Redux slices

// Integration Tests (20%)  
- Screen components with mocked API
- Navigation flows
- Form submissions

// E2E Tests (10%)
- Critical user journeys
- Authentication flow
- Report creation flow
```

---

## 1Ô∏è‚É£2Ô∏è‚É£ **Changelog**

### **v0.1.0 - Phase 1 Foundation ‚úÖ COMPLETE**
- ‚úÖ Redux Toolkit + RTK Query setup
- ‚úÖ React Native Paper theming
- ‚úÖ Navigation structure (Auth + Main tabs)
- ‚úÖ Mock data implementation
- ‚úÖ Error boundaries and loading states
- ‚úÖ Permission management hooks
- ‚úÖ Reusable UI components

### **v0.2.0 - Phase 2 Authentication & Core UI (NEXT)**
- [ ] OpenAPI contract definition
- [ ] Real API integration setup
- [ ] Enhanced auth screens
- [ ] Form validation improvements
- [ ] Environment configuration

### **v0.3.0 - Phase 3 Map Implementation**
- [ ] Map library integration
- [ ] Bbox-based queries
- [ ] Clustering implementation
- [ ] Real-time marker updates

---

## 1Ô∏è‚É£3Ô∏è‚É£ **FAQ**

**Q: Neden Redux Toolkit, Zustand deƒüil?**
A: Enterprise-level cache management, devtools integration ve RTK Query'nin invalidation stratejisi i√ßin.

**Q: React Native Paper vs NativeBase?**
A: Material Design 3 uyumluluƒüu, TypeScript desteƒüi ve React Native ekosistemindeki olgunluk.

**Q: Neden bbox zorunlu?**
A: Harita-merkezli kullanƒ±mda viewport odaklƒ± veri √ßekimi performans avantajƒ± saƒülar.

**Q: Mock data ne zaman kaldƒ±rƒ±lacak?**
A: Backend API'leri hazƒ±r olduk√ßa kademeli olarak real API'ye ge√ßi≈ü yapƒ±lacak.

---

## üìû **Destek ve ƒ∞leti≈üim**

- **Frontend Issues:** GitHub Issues ile
- **API Contract Changes:** Backend ekibi ile koordinasyon
- **Design System:** React Native Paper dok√ºmantasyonu
- **State Management:** Redux Toolkit Query rehberi

---

*Bu dok√ºman her sprint sonunda g√ºncellenir ve backend progress tracker ile senkronize tutulur.*