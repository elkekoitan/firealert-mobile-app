#!/usr/bin/env node

// OpenAPI tip Ã¼retim script'i
// Bu script docs/openapi.yaml dosyasÄ±ndan TypeScript tiplerini Ã¼retir

import { execSync } from 'child_process';
import { readFileSync, writeFileSync, existsSync } from 'fs';
import { join } from 'path';

const openApiPath = join(__dirname, '../docs/openapi.yaml');
const typesPath = join(__dirname, '../src/types/api-types.ts');

console.log('ğŸ”§ OpenAPI tip Ã¼retimi baÅŸlatÄ±lÄ±yor...');

// OpenAPI dosyasÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± kontrol et
if (!existsSync(openApiPath)) {
  console.error('âŒ OpenAPI dosyasÄ± bulunamadÄ±:', openApiPath);
  console.log('ğŸ“ docs/openapi.yaml dosyasÄ±nÄ± oluÅŸturun veya dosya yolunu gÃ¼ncelleyin.');
  process.exit(1);
}

try {
  // openapi-typescript ile tip Ã¼retimi
  console.log('ğŸ“„ OpenAPI dosyasÄ± okunuyor...');
  const openApiContent = readFileSync(openApiPath, 'utf8');
  
  console.log('âš¡ TypeScript tipleri Ã¼retiliyor...');
  execSync(`npx openapi-typescript ${openApiPath} -o ${typesPath}`, {
    stdio: 'inherit',
    cwd: process.cwd(),
  });

  console.log('âœ… TypeScript tip Ã¼retimi tamamlandÄ±!');
  console.log(`ğŸ“ Ãœretilen dosya: ${typesPath}`);
  
  // Ä°mport ve export eklemeleri
  console.log('ğŸ”§ Ä°mport/export eklemeleri yapÄ±lÄ±yor...');
  const generatedContent = readFileSync(typesPath, 'utf8');
  
  // Path tipini import et
  const enhancedContent = `// Auto-generated from docs/openapi.yaml
// Do not edit this file directly

import type { PathsWithMethod } from 'openapi-typescript-helpers';

${generatedContent}

// API endpoint'leri iÃ§in tip yardÄ±mcÄ±larÄ±
export type ApiPaths = PathsWithMethod<typeof paths>;
export type ApiComponents = typeof paths['components'];
`;

  writeFileSync(typesPath, enhancedContent);
  
  console.log('âœ… OpenAPI tip Ã¼retimi baÅŸarÄ±yla tamamlandÄ±!');
  console.log('ğŸš€ ArtÄ±k API endpoint'lerini kullanabilirsiniz.');
  
} catch (error) {
  console.error('âŒ OpenAPI tip Ã¼retiminde hata oluÅŸtu:', error);
  console.log('ğŸ”§ openapi-typescript kurulu mu kontrol edin:');
  console.log('   npm install -D openapi-typescript');
  process.exit(1);
}